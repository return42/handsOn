
<!DOCTYPE html>

<html lang="de">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>pi-hole &#8212; handsOn  Dokumentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/translations.js"></script>
    <link rel="index" title="Stichwortverzeichnis" href="../genindex.html" />
    <link rel="search" title="Suche" href="../search.html" />
    <link rel="next" title="Exkursionen und Erfahrungswerte" href="../excursion/index.html" />
    <link rel="prev" title="Glances: an eye on your system" href="../glances.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Stichwortverzeichnis"
             accesskey="I">Index</a></li>
        <li class="right" >
          <a href="../excursion/index.html" title="Exkursionen und Erfahrungswerte"
             accesskey="N">weiter</a> |</li>
        <li class="right" >
          <a href="../glances.html" title="Glances: an eye on your system"
             accesskey="P">zurück</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">handsOn  Dokumentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">pi-hole</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="id1">
<h1>pi-hole<a class="headerlink" href="#id1" title="Permalink to this heading">¶</a></h1>
<p>Die <a class="reference external" href="https://pi-hole.net/">pi-hole</a> ist ein lokaler <a class="reference external" href="https://de.wikipedia.org/wiki/Domain_Name_System">DNS (wiki)</a> Server, der Domain-Namen mit Werbung
und Trackern blockiert (nicht auflöst).  Kuketz hat zu den Hintergründen und zum
Einrichten einer solchen pi-hole einen umfassenden Artikel verfasst, siehe:
<a class="reference external" href="https://www.kuketz-blog.de/pi-hole-schwarzes-loch-fuer-werbung-raspberry-pi-teil1/">Kuketz pi-hole Artikel</a></p>
<section id="pi-hole-und-fritz-box">
<h2>pi-hole und Fritz-Box<a class="headerlink" href="#pi-hole-und-fritz-box" title="Permalink to this heading">¶</a></h2>
<p>Hat man die pi-hole eingerichtet, steht der lokale DNS Dienst bereit und muss
nun noch den Clients resp. dem Router bekannt gemacht werden.  Die meisten
Router sind so eingerichtet, dass die Clients ihr Netzwerk-Setup via <a class="reference external" href="https://de.wikipedia.org/wiki/Dynamic_Host_Configuration_Protocol">DHCP
(wiki)</a> vom Router beziehen.  In dem <a class="reference external" href="https://www.kuketz-blog.de/pi-hole-schwarzes-loch-fuer-werbung-raspberry-pi-teil1/">Kuketz pi-hole Artikel</a> werden im
Kapitel <em>„Einrichtung als DNS-Server“</em> drei alternative Varianten vorgestellt.</p>
<p>Bei <strong>Variante 2 – per DHCP</strong> wird die pi-hole (also die IP des lokalen DNS) im
Rahmen des DHCP an die Clients weiter gereicht.  In der Fritz-Box unter:</p>
<ul class="simple">
<li><p><span class="menuselection">Heimnetz -&gt; Netzwerk -&gt; Netzwerkeinstellungen -&gt;
IPv4-Adressen</span></p></li>
</ul>
<p>muss der DHCP-Server der Fritz-Box aktiviert sein und unter <strong>Lokaler
DNS-Server</strong> setzt man die IP der pi-hole.  Hier im Beispiel ist das die
<code class="docutils literal notranslate"><span class="pre">192.168.1.118</span></code>:</p>
<figure class="align-default">
<img alt="Figure (pihole-FB-IPv4-Adressen-DHCP-lokaler-DNS.png)" class="rst-figure" src="../_images/pihole-FB-IPv4-Adressen-DHCP-lokaler-DNS.png" />
</figure>
<p>Nach bestätigen mit <span class="guilabel">OK</span> werden alle zukünftigen (DHCP) Verbindungen
als DNS die pi-hole verwenden.  Will man das sofort mal testen, muss man die
Netzwerkverbindung auf dem Client-Rechner kurz ab- und wieder anschalten (oder
neu booten).  Danach sollte im <em>NetworkManager</em> die IP des DNS angezeigt werden
(s.a.: <a class="reference internal" href="#check-which-dns"><span class="std std-ref">DNS überprüfen</span></a>).</p>
<p>Damit die FritzBox selbst auch die pi-hole als <em>bevorzugten DNSv4-Server</em> nutzt,
kann noch die folgende Einstellung vorgenommen werden.</p>
<ul class="simple">
<li><p><span class="menuselection">Internet -&gt; Zugangsdaten -&gt; DNS-Server</span></p></li>
</ul>
<figure class="align-default">
<img alt="Figure (pihole-FB-DNS-Server.png)" class="rst-figure" src="../_images/pihole-FB-DNS-Server.png" />
</figure>
<p>Die IP der pi-hole hier im Beispiel ist <code class="docutils literal notranslate"><span class="pre">192.168.1.118</span></code>.  Falls die mal ausfällt
wurde noch der <a class="reference external" href="https://www.ccc.de/de/censorship/dns-howto">Chaos Computer Club (DNS)</a> als Alternative eingetragen
(s.a. <a class="reference internal" href="#upstream-dns-server">Upstream DNS Server</a>)</p>
<section id="dns-uberprufen">
<span id="check-which-dns"></span><h3>DNS überprüfen<a class="headerlink" href="#dns-uberprufen" title="Permalink to this heading">¶</a></h3>
<p>Auf der Linux Kommandozeile kann man dazu
z.B. <a class="reference external" href="http://manpages.ubuntu.com/cgi-bin/search.py?q=nmcli">nmcli</a> verwenden:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ nmcli
...
DNS configuration:
        servers: 192.168.1.118
        domains: fritz.box
        interface: enp3s0

$ nmcli device show
GENERAL.DEVICE:                         enp3s0
...
IP4.ADDRESS[1]:                         192.168.1.127/24
IP4.GATEWAY:                            192.168.1.1
...
IP4.DNS[1]:                             192.168.1.118
IP4.DOMAIN[1]:                          fritz.box
</pre></div>
</div>
<p>Auf Windows kann man das Kommando <code class="docutils literal notranslate"><span class="pre">nslookup</span></code> aufrufen.  Bereits beim Start
zeigt es den DNS an, den es zur Namensauflösung nutzt.</p>
<figure class="align-default">
<img alt="Figure (pihole-win-nslookup.png)" class="rst-figure" src="../_images/pihole-win-nslookup.png" />
</figure>
</section>
</section>
<section id="upstream-dns-server">
<h2>Upstream DNS Server<a class="headerlink" href="#upstream-dns-server" title="Permalink to this heading">¶</a></h2>
<p>In der pi-hole kann man einstellen welche DNS Server die pi-hole verwenden soll.
In dem <a class="reference external" href="https://www.kuketz-blog.de/dns-unzensierte-und-freie-dns-server-ohne-protokollierung/">Kuketz DNS Artikel</a> werden <em>Unzensierte und freie DNS-Server ohne
Protokollierung</em> vorgestellt.  Hier im Beispiel verwende ich DNS Server die
<a class="reference external" href="https://de.wikipedia.org/wiki/Domain_Name_System_Security_Extensions">DNSSEC (wiki)</a> unterstützen.</p>
<ul>
<li><p><a class="reference external" href="https://dns.watch/">DNS.WATCH</a> IPv4:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">84.200.69.80</span>
<span class="mf">84.200.70.40</span>
</pre></div>
</div>
</li>
<li><p><a class="reference external" href="https://www.ccc.de/de/censorship/dns-howto">Chaos Computer Club (DNS)</a> IPv4:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">194.150.168.168</span>
</pre></div>
</div>
</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warnung</p>
<p>Die Option <span class="guilabel">Use DNSSEC</span> sollte nur verwendet werden, wenn alle
<em>upstream</em> DNS-Server auch DNSSEC unterstützen!  Anderen Falles kommt es bei
der Namensauflösung zu Problemen.  I.d.R. spürt man das sehr deutlich, da die
pi-hole dann gar keine Namen mehr auflösen kann und von daher alle
<em>blockiert</em>.</p>
</div>
<p>Um die lokalen Namen ebenfalls auflösen zu können empfiehlt es sich noch
<span class="guilabel">Use Conditional Routing</span> zu aktivieren und dort die IP der Fritz-Box
einzutragen.  Der Name der Fritz-Box im lokalem Netz ist <code class="docutils literal notranslate"><span class="pre">fritz.box</span></code> (sofern
man das in der FB nicht geändert hat), die IP hier im Beispiel ist
<code class="docutils literal notranslate"><span class="pre">192.168.1.1</span></code>.</p>
<figure class="align-default">
<img alt="Figure (pihole-settings-DNS.png)" class="rst-figure" src="../_images/pihole-settings-DNS.png" />
</figure>
</section>
<section id="host-namen-aus-subnetzen">
<h2>Host-Namen aus Subnetzen<a class="headerlink" href="#host-namen-aus-subnetzen" title="Permalink to this heading">¶</a></h2>
<p>In einer IP Infrastruktur mit Subnetzen (die z.B. über VPN angebunden sind) sind
die Host-Namen aus <em>anderen</em> Subnetzen nicht ohne weiteres auflösbar.</p>
<p>Der DNS der pi-hole nutzt die <code class="docutils literal notranslate"><span class="pre">/etc/hosts</span></code> Datei auf der pi-hole ebenfalls zur
Namensauflösung.  Eine einfache Lösung um Host-Namen im eigenen Subnetz bekannt
zu machen besteht deshalb darin, unbekannte Host-Namen in die <code class="docutils literal notranslate"><span class="pre">/etc/hosts</span></code> der
pi-hole direkt einzutragen.  Dazu meldet man sich an der pi-hole via ssh an
(hier im Beispiel <code class="docutils literal notranslate"><span class="pre">192.168.1.118</span></code>) und editiert die hosts-Datei:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ssh pi@192.168.1.118
pi@192.168.1.118&#39;s password: ....

$ sudo -H nano /etc/hosts
</pre></div>
</div>
<p>Meist steht am Anfang der <code class="docutils literal notranslate"><span class="pre">/etc/hosts</span></code> so was wie:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">127.0.0.1</span>        <span class="n">localhost</span>
<span class="p">::</span><span class="mi">1</span>              <span class="n">localhost</span> <span class="n">ip6</span><span class="o">-</span><span class="n">localhost</span> <span class="n">ip6</span><span class="o">-</span><span class="n">loopback</span>
<span class="n">ff02</span><span class="p">::</span><span class="mi">1</span>          <span class="n">ip6</span><span class="o">-</span><span class="n">allnodes</span>
<span class="n">ff02</span><span class="p">::</span><span class="mi">2</span>          <span class="n">ip6</span><span class="o">-</span><span class="n">allrouters</span>
</pre></div>
</div>
<p>Hat man beispielsweise VPN Knoten könnte man diese ebenfalls hier eintragen:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">192.168.0.1</span>      <span class="n">vpn</span><span class="o">.</span><span class="n">hamburg</span><span class="o">.</span><span class="n">local</span>
<span class="mf">192.168.1.1</span>      <span class="n">vpn</span><span class="o">.</span><span class="n">hannover</span><span class="o">.</span><span class="n">local</span>
<span class="mf">192.168.2.1</span>      <span class="n">vpn</span><span class="o">.</span><span class="n">bremen</span><span class="o">.</span><span class="n">local</span>
</pre></div>
</div>
<p>Die Hosts mit den Anwendungen an entfernten Standorten trägt man ebenfalls ein:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">192.168.0.34</span>     <span class="n">hamburg</span>  <span class="n">app</span><span class="o">.</span><span class="n">hamburg</span><span class="o">.</span><span class="n">local</span>
<span class="mf">192.168.1.120</span>    <span class="n">hannover</span> <span class="n">app</span><span class="o">.</span><span class="n">hannover</span><span class="o">.</span><span class="n">local</span>
<span class="mf">192.168.2.124</span>    <span class="n">bremen</span>   <span class="n">app</span><span class="o">.</span><span class="n">bremen</span><span class="o">.</span><span class="n">local</span>
</pre></div>
</div>
</section>
<section id="blocklists">
<h2>Blocklists<a class="headerlink" href="#blocklists" title="Permalink to this heading">¶</a></h2>
<p>Die Blocklists kann man im Admin Inetrface der pi-hole ändern:</p>
<ul class="simple">
<li><p><span class="menuselection">Settings ‣ Blocklists</span></p></li>
</ul>
<p>Hier noch ein paar Vorschläge für Blocklists:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>http://sysctl.org/cameleon/hosts
http://vxvault.net/URL_List.php
https://easylist-downloads.adblockplus.org/easyprivacy+easylist.txt
https://easylist.to/easylistgermany/easylistgermany.txt
https://fanboy.co.nz/r/fanboy-complete.txt
https://filters.adtidy.org/extension/chromium/filters/11.txt
https://filters.adtidy.org/extension/chromium/filters/14.txt
https://filters.adtidy.org/extension/chromium/filters/3.txt
https://filters.adtidy.org/extension/chromium/filters/6.txt
https://filters.adtidy.org/windows/filters/11.txt?id=11
https://filters.adtidy.org/windows/filters/15.txt
https://github.com/crazy-max/WindowsSpyBlocker/blob/master/data/hosts/spy.txt
https://hosts-file.net/ad_servers.txt
https://mirror1.malwaredomains.com/files/justdomains
https://phishing.army/download/phishing_army_blocklist_extended.txt
https://ransomwaretracker.abuse.ch/downloads/RW_DOMBL.txt
https://ransomwaretracker.abuse.ch/downloads/RW_URLBL.txt
https://raw.githubusercontent.com/EnergizedProtection/block/master/ultimate/formats/hosts
https://raw.githubusercontent.com/StevenBlack/hosts/master/hosts
https://raw.githubusercontent.com/reek/anti-adblock-killer/master/anti-adblock-killer-filters.txt
https://s3.amazonaws.com/lists.disconnect.me/simple_ad.txt
https://s3.amazonaws.com/lists.disconnect.me/simple_tracking.txt
https://www.squidblacklist.org/downloads/dg-malicious.acl
https://zeustracker.abuse.ch/blocklist.php?download=domainblocklist
</pre></div>
</div>
<div class="admonition hint">
<p class="admonition-title">Hinweis</p>
<p>Beim ersten Eintragen der/aller oben genannten Blocklists kann das Update
nach der Bestätigung über <span class="guilabel">Save and Update</span> etwas länger dauern.</p>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
  <span id="sidebar-top"></span>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  
    
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/darmarIT_logo_128.png" alt="Logo"/>
            </a></p>
  

  <h3>Contents</h3>
  <ul>
<li><a class="reference internal" href="#">pi-hole</a><ul>
<li><a class="reference internal" href="#pi-hole-und-fritz-box">pi-hole und Fritz-Box</a><ul>
<li><a class="reference internal" href="#dns-uberprufen">DNS überprüfen</a></li>
</ul>
</li>
<li><a class="reference internal" href="#upstream-dns-server">Upstream DNS Server</a></li>
<li><a class="reference internal" href="#host-namen-aus-subnetzen">Host-Namen aus Subnetzen</a></li>
<li><a class="reference internal" href="#blocklists">Blocklists</a></li>
</ul>
</li>
</ul>
<h3>Navigation</h3>
<ul>
  <li><a href="../index.html">Overview</a>
    <ul>
          <li>Previous: <a href="../glances.html" title="vorheriges Kapitel">Glances: an eye on your system</a>
          <li>Next: <a href="../excursion/index.html" title="nächstes Kapitel">Exkursionen und Erfahrungswerte</a>
    </ul>
  </li>
</ul>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Schnellsuche</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Los" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><div id="ethical-ad-placement"></div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019 Markus Heiser.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    </div>
  <script src="../_static/version_warning_offset.js"></script>

  </body>
</html>