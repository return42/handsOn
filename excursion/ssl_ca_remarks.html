
<!DOCTYPE html>

<html lang="de">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Anmerkungen zu SSL und Zertifikaten &#8212; handsOn  Dokumentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/translations.js"></script>
    <link rel="index" title="Stichwortverzeichnis" href="../genindex.html" />
    <link rel="search" title="Suche" href="../search.html" />
    <link rel="next" title="Exkursion: Netzmaske / IPv4 und IPv6" href="excursion_IPv4_6.html" />
    <link rel="prev" title="Suchmaschinen &amp; Tracking" href="search_engines.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Stichwortverzeichnis"
             accesskey="I">Index</a></li>
        <li class="right" >
          <a href="excursion_IPv4_6.html" title="Exkursion: Netzmaske / IPv4 und IPv6"
             accesskey="N">weiter</a> |</li>
        <li class="right" >
          <a href="search_engines.html" title="Suchmaschinen &amp; Tracking"
             accesskey="P">zurück</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">handsOn  Dokumentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Exkursionen und Erfahrungswerte</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Anmerkungen zu SSL und Zertifikaten</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="anmerkungen-zu-ssl-und-zertifikaten">
<span id="xref-ssl-ca-remarks"></span><h1>Anmerkungen zu SSL und Zertifikaten<a class="headerlink" href="#anmerkungen-zu-ssl-und-zertifikaten" title="Permalink to this heading">¶</a></h1>
<aside class="sidebar">
<p class="sidebar-title"><a class="reference external" href="https://badssl.com/">https://badssl.com/</a></p>
<p>Eine WEB-Seite, auf der man das Verhalten seines WEB-Browsers auf <em>schlechte</em>
SSL Verbindungen testen kann</p>
</aside>
<p>Die hier vorgestellten Setups benutzen als Transportschicht SSL. Mit SSL wird
dann meist auch ein Zertifikat erforderlich. Meiner Ansicht nach sind
<em>selbstsignierte</em> Zertifikate, wie sie die Debian/Ubuntu Distribution (snakeoil)
mit dem Paket <a class="reference external" href="http://packages.ubuntu.com/ssl-cert">ssl-cert</a> einrichten, an sich vollkommend ausreichend.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ssl</span><span class="o">/</span><span class="n">certs</span><span class="o">/</span><span class="n">ssl</span><span class="o">-</span><span class="n">cert</span><span class="o">-</span><span class="n">snakeoil</span><span class="o">.</span><span class="n">pem</span>
</pre></div>
</div>
<p>Will man sich sein (snakeoil) Zertifikat mal genauer anschauen, dann kann man
das z.B. mit dem folgenden Kommando.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>openssl<span class="w"> </span>x509<span class="w"> </span>-text<span class="w"> </span>-in<span class="w"> </span>/etc/ssl/certs/ssl-cert-snakeoil.pem
</pre></div>
</div>
<p>Im WEB-Browser führen diese selbstsignierten Zertifakte zu einer Warnmeldung
weil sie über keine (der im WEB-Browser vorinstallierten) Zertifizierungstellen
signiert wurden. Im WEB-Browser muss/kann man auf diese Warnung hin das
Zertifakt aktzeptieren, was im Allgemeinen kein Problem darstellen sollte.</p>
<aside class="sidebar">
<p class="sidebar-title">FFox UPDATE</p>
<p>Inzwischen ist es im default nicht mehr möglich Ausnahmen zu akzeptieren.  Um
Ausnahmen weiterhin akzeptieren zu können, muss unter <code class="docutils literal notranslate"><span class="pre">crome:config</span></code> (URL)
folgende Einstellung vorgenommen werden:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">browser</span><span class="o">.</span><span class="n">xul</span><span class="o">.</span><span class="n">error_pages</span><span class="o">.</span><span class="n">expert_bad_cert</span> <span class="o">=</span> <span class="n">false</span>
</pre></div>
</div>
</aside>
<p>Betreibt man die WEB-Seite im Internet, dann verunsichern die <em>Terrorpanik -
Warndialoge</em> aus dem WEB-Broswer den unbedarften Besucher jedoch schnell. FFox
und andere WEB-Browser haben im <em>Default</em> bereits eine Liste von
Zertifizierungsstellen (<a class="reference external" href="https://de.wikipedia.org/wiki/Zertifizierungsstelle">CA (wiki)</a>) eingebaut (die <a class="reference external" href="https://wiki.mozilla.org/CA:IncludedCAs">Mozilla Included CA
Certificate List</a>). Jeder der im Internet eine Seite mit einem <em>CA
zertifizierten</em> Zertifikat besucht vertraut darauf, dass die CAs, welche die
<em>Echtheit</em> dieser Seite bestätigen auch vertraunswürdig sind.</p>
<p>Sichere Kommunikation basiert also immer auf einem Vertrauen. In dem Fall auf
dem Vertrauen in eine Reihe von CA’s, die eine Gruppe (rund um z.B. Mozilla) als
„vertrauenswürdig“ eingestuft hat. Es stellt sich die Frage; wem kann man (mehr)
vertrauen? Den zum Teil intransparenten CAs oder kann man gleich dem
selbstsignierten Zertifikat trauen?  Fefe beschreibt das Dilema von Vertrauen
recht gut in seinem Blog <a class="reference external" href="https://blog.fefe.de/?ts=b25933c5">Fefe’s Blog / Sun Oct 3 2010</a>.</p>
<div class="admonition note">
<p class="admonition-title">Bemerkung</p>
<p>Um es kurz zu machen, Sicherheit ist eine Frage von Vertrauen. Ob man allen
CAs in den Browsern vertrauen kann ist zumindest hinterfragbar solange die
Prozesse eines CAs und seine Motivation nicht transparent sind. Die
<a class="reference external" href="https://letsencrypt.org/">letsencrypt.org</a> mag auch umstritten sein, sie ist aber zumindest
transparent und wird offen im Netzt diskutiert.  Wer einen (kleinen)
WEB-Server im Netz betreibt und gerne zertiffiziert werden möchte, der möge
sich mit der <a class="reference external" href="https://letsencrypt.org/">letsencrypt.org</a> Campange auseinander setzen.</p>
</div>
<section id="hinzufugen-des-zertifikats-eines-remote-host">
<span id="install-certs"></span><h2>Hinzufügen des Zertifikats eines Remote-Host<a class="headerlink" href="#hinzufugen-des-zertifikats-eines-remote-host" title="Permalink to this heading">¶</a></h2>
<p>Es empfiehlt sich die selbst-signierten Zertifikate der Server im <strong>Intranet</strong>
auch auf den Client-Hosts zu registrieren.  Hierzu kann das beiliegende Script
verwendet werden:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>./scripts/certs<span class="w"> </span>install
</pre></div>
</div>
<p>Im allgemeinen akzeptieren die Programme auf dem Client die so installierten
Zertifikate, aber wie immer gibt es auch hierbei Ausnahmen.</p>
<div class="admonition note">
<p class="admonition-title">Bemerkung</p>
<p>Webbrowser wie Firefox, Chrome etc., als auch der Mailclient Mozilla
Thunderbird haben ihre eigenen Trust-Center.</p>
</div>
<p>Bei solchen Anwendungen liegt die CA Datenbank i.d.R. irgendwo im HOME-Ordner
des Anwenders, meist beim Profil der jeweiligen Anwendung. Das kann seitens der
Administration nicht sinnvoll gehandhabt werden und so muss jeder Benutzer das
Zertifikat des WEB-/Mail- Servers manuell akzeptieren. Leider sind dazu meist
einige zusätzliche Maus-Klicks erforderlich, sobald man den Mail-Account
einrichtet oder die Seite im Intranet aufruft.</p>
<p>Andere Programme die den SSL Stack des Systems benutzen (ssh, git …) nutzen
die systemweiten CA’s und arbeiten auch mit den selbst-signierten problemlos.</p>
<section id="windows">
<h3>Windows<a class="headerlink" href="#windows" title="Permalink to this heading">¶</a></h3>
<p>Auf Windows empfehle ich git zu installieren, dann hat man auch gleichzeitig ein
openssl Client. Dazu die Git-Bash öffnen und folgendes eingeben. Dabei die
beiden <code class="docutils literal notranslate"><span class="pre">&lt;hostname&gt;</span></code> durch den Namen des Remote-Host ersetzen:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">Downloads</span>
<span class="n">openssl</span> <span class="n">s_client</span> <span class="o">-</span><span class="n">showcerts</span> <span class="o">-</span><span class="n">connect</span> <span class="o">&lt;</span><span class="n">hostname</span><span class="o">&gt;</span><span class="p">:</span><span class="mi">443</span> <span class="o">&lt;/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span> <span class="mi">2</span><span class="o">&gt;/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span> <span class="o">|</span> <span class="n">openssl</span> <span class="n">x509</span> <span class="o">-</span><span class="n">outform</span> <span class="n">PEM</span> <span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">hostname</span><span class="o">&gt;.</span><span class="n">crt</span>
</pre></div>
</div>
<p>Sollte sich das Programm nicht benden (bei Win stimmt was mit den PIPEs nicht)
CTRL-C drücken und nachschauen ob es (trotzdem) geklappt hat:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">&lt;</span><span class="n">hostname</span><span class="o">&gt;.</span><span class="n">crt</span>
</pre></div>
</div>
<p>Das <code class="docutils literal notranslate"><span class="pre">cat</span></code> sollte das Zertifikat anzeigen. Wenn nicht, muss man sich das
irgendwie anders holen. Danach den Anweisungen unter dem <em>Link</em> folgen und dabei
das Zertifikat <code class="docutils literal notranslate"><span class="pre">&lt;hostname&gt;.crt</span></code> einspielen.</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference external" href="https://technet.microsoft.com/de-de/library/cc754841(v=ws.11).aspx#BKMK_addlocal">https://technet.microsoft.com/de-de/library/cc754841(v=ws.11).aspx#BKMK_addlocal</a></p></li>
</ul>
</div></blockquote>
</section>
<section id="android">
<span id="android-snakeoil"></span><h3>Android<a class="headerlink" href="#android" title="Permalink to this heading">¶</a></h3>
<p>Die Installation eines selbst signierten Zertifikats (wie
z.B. <code class="docutils literal notranslate"><span class="pre">ssl-cert-snakeoil.pem</span></code>) auf einem Android Device wollte mir über das
Benutzerinterface nicht gelingen, am Ende musste zur <em>Holzhammer</em> Methode
greifen, die hier kurz beschrieben werden soll.</p>
<p>Für die <em>Holzhammer</em> Methode benötigt man die <a class="reference external" href="https://developer.android.com/studio/command-line/adb.html">Android Debug Bridge (adb)</a>. Auf
Debian/Ubuntu kann man diese mit dem apt Paketmanager installieren:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>sudo<span class="w"> </span>-H<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>android-tools-adb<span class="w"> </span>android-tools-fastboot
</pre></div>
</div>
<p>Als nächstes muss man das <em>versteckte</em> „Entwickler Menü“ aktivieren
(<a class="reference internal" href="../android/dev_options.html#android-dev-options"><span class="std std-ref">Entwickler-Optionen</span></a>).</p>
<p>Wenn man jetzt wieder auf „Einstellungen“ wechselt, sieht man in dem Menu ganz
unten als vorletzten Eintrag die „Entwickleroptionen“, dort drauf klicken und
in dem folgenden Menü folgendes aktivieren.</p>
<ul class="simple">
<li><p>Root-Zugriff: ADB</p></li>
<li><p>Android-Debugging: <em>ON</em></p></li>
</ul>
<p>Spätestens jetzt sollte man das Android via USB Kabel an den PC verbinden.
Abhängig vom Desktop System des PC sollte sich dabei ein Dateibrowser öffnen und
man kann sich dort zu einem Ordner Namens <code class="docutils literal notranslate"><span class="pre">Download</span></code> durchangeln. In diesen
Ordner werden wir später das Zertifikat auf das Android kopieren. Zuvor müssen
wir jedoch das selbst signierte Zertifikat des Servers aufbereiten (siehe auch
<a class="reference external" href="http://wiki.cacert.org/FAQ/ImportRootCert#Android_Phones_.26_Tablets">CAcert: Android Phones &amp; Tablets</a>).</p>
<p>Im folgenden gehe ich auf den Linux-Server und bereite das Zertifikat auf:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>myPC<span class="w"> </span>$<span class="w"> </span>ssh<span class="w"> </span>myusername@myserver
myserver<span class="w"> </span>$<span class="w"> </span>cp<span class="w"> </span>/etc/ssl/certs/ssl-cert-snakeoil.pem<span class="w"> </span>/tmp/myserver_cert.pem
myserver<span class="w"> </span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>/tmp
myserver<span class="w"> </span>$<span class="w"> </span>openssl<span class="w"> </span>x509<span class="w"> </span>-inform<span class="w"> </span>PEM<span class="w"> </span>-subject_hash_old<span class="w"> </span>-in<span class="w">  </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-1
myserver<span class="w"> </span>$<span class="w"> </span>openssl<span class="w"> </span>x509<span class="w"> </span>-inform<span class="w"> </span>PEM<span class="w"> </span>-subject_hash_old<span class="w"> </span>-in<span class="w"> </span>myserver_cert.pem<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-1
c091000a
</pre></div>
</div>
<p>Der Wert <code class="docutils literal notranslate"><span class="pre">c091000a</span></code> ist ein Hash-Wert des Zertifikates, der bei jedem
Zertifikat anders aussehen wird. Wir verwenden diesen Wert als Dateinamen, indem
wir am Ende noch ein <code class="docutils literal notranslate"><span class="pre">.0</span></code> dran hängen. Hier im Beispiel also <code class="docutils literal notranslate"><span class="pre">c091000a.0</span></code>
mit dem eigeneen Zertifikat also analog <code class="docutils literal notranslate"><span class="pre">{hash-value}.0</span></code>.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cat<span class="w"> </span>myserver_cert.pem<span class="w"> </span>&gt;<span class="w"> </span>c091000a.0
$<span class="w"> </span>openssl<span class="w"> </span>x509<span class="w"> </span>-inform<span class="w"> </span>PEM<span class="w"> </span>-text<span class="w"> </span>-in<span class="w"> </span>myserver_cert.pem<span class="w"> </span>-out<span class="w"> </span>/dev/null<span class="w"> </span>&gt;&gt;<span class="w"> </span>c091000a.0
</pre></div>
</div>
<p>Nun liegt das aufbereitete Zertifikat auf dem Server unter
<code class="docutils literal notranslate"><span class="pre">/tmp/{hash-value}.0</span></code>.  Von dort muss man es nun in den Download Ordner des
Androids kopieren. Also z.B. erst mal auf den PC kopieren und von dort dann auf
das – via USB – angeschlossene Android kopieren. Da hier bei mir alles Linux
ist mache ich das indem ich das Zertifikat erst mal in den HOME Ordner auf dem
PC kopiere und dann mit <code class="docutils literal notranslate"><span class="pre">adb</span></code> auf das Android kopiere.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>myPC<span class="w"> </span>$<span class="w"> </span>scp<span class="w"> </span>myusername@myserver:/tmp/<span class="o">{</span>hash-value<span class="o">}</span>.0<span class="w"> </span><span class="nv">$HOME</span>
</pre></div>
</div>
<p>Nachdem man das Zertifikat auf dem PC hat kann man es auch mit dem Datei
Explorer in den Download Ordner des Android kopieren (s.o.). Ich mach das mal
mit der adb, weil sich das einfacher aufschreiben lässt.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>myPC<span class="w"> </span>$<span class="w"> </span>adb<span class="w"> </span>push<span class="w"> </span><span class="nv">$HOME</span>/c091000a.0<span class="w"> </span>/sdcard/Downloads
<span class="m">66</span><span class="w"> </span>KB/s<span class="w"> </span><span class="o">(</span><span class="m">3721</span><span class="w"> </span>bytes<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">0</span>.054s<span class="o">)</span>
</pre></div>
</div>
<p>Nachdem man das Zertifikat nun endlich auf dem Android hat, muss man es noch
installieren. Dazu macht man mit dem adb auf dem Android eine shell auf und
wechselt in den root user (su), denn nur der hat die erforderlichen Rechte
(deswegen wurde oben auch „Root-Zugriff: ADB“ eingestellt).</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>myPC<span class="w"> </span>$<span class="w"> </span>adb<span class="w"> </span>shell
shell@maguro:/<span class="w"> </span>$<span class="w"> </span>su
root@maguro:/<span class="w"> </span><span class="c1"># su</span>
</pre></div>
</div>
<p>Die System Zertifikate liegen im <code class="docutils literal notranslate"><span class="pre">/system</span></code> Ordner, dieser ist allerdings
read-only gemountet. Um auch darin schreiben zu können wird der Ordner nochmal
mit read/write gemountet. Danach kann dann das Zertifikat in den <code class="docutils literal notranslate"><span class="pre">cacerts/</span></code>
Ordner kopiert werden und es werden noch die Dateirechte so eingestellt, dass
<em>jeder</em> die Datei lesen kann.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>root@maguro:/<span class="w"> </span><span class="c1"># mount -o remount,rw /system/</span>
root@maguro:/<span class="w"> </span><span class="c1"># cp /sdcard/Download/c091000a.0  /system/etc/security/cacerts/</span>
root@maguro:/<span class="w"> </span><span class="c1"># chmod 644 /system/etc/security/cacerts/c091000a.0</span>
</pre></div>
</div>
<p>Nun muss das Android einmal neu gebootet werden, dazu ganz ausschalten oder
<code class="docutils literal notranslate"><span class="pre">su</span></code> verlassen und <code class="docutils literal notranslate"><span class="pre">reboot</span></code> aufrufen.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>root@maguro:/<span class="w"> </span><span class="c1"># exit</span>
shell@maguro:/<span class="w"> </span>$<span class="w"> </span>reboot
</pre></div>
</div>
<p>Nach dem Reboot findet man das selbst signiertes Zertifikat unter „Einstellungen
&gt; Sicherheit &gt; Vertrauenswürdige Anmeldedaten“ im Reiter „System“ wieder. Der
Name des Zertifikats trägt dabei i.d.R. den Namen des Host, für das man es
erstellt hat.  Alle Android Apps, welche den SSL (Java) Stack des Androids
benutzen sollten nun ohne Probleme verschlüsselt mit dem selbst signierten
Server kommunizieren können (bei mir war das z.B. Firefox-Sync eines Android
FFox).</p>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
  <span id="sidebar-top"></span>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  
    
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/darmarIT_logo_128.png" alt="Logo"/>
            </a></p>
  

  <h3>Contents</h3>
  <ul>
<li><a class="reference internal" href="#">Anmerkungen zu SSL und Zertifikaten</a><ul>
<li><a class="reference internal" href="#hinzufugen-des-zertifikats-eines-remote-host">Hinzufügen des Zertifikats eines Remote-Host</a><ul>
<li><a class="reference internal" href="#windows">Windows</a></li>
<li><a class="reference internal" href="#android">Android</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3>Navigation</h3>
<ul>
  <li><a href="../index.html">Overview</a>
    <ul>
      <li><a href="index.html">Exkursionen und Erfahrungswerte</a>
        <ul>
          <li>Previous: <a href="search_engines.html" title="vorheriges Kapitel">Suchmaschinen &amp; Tracking</a>
          <li>Next: <a href="excursion_IPv4_6.html" title="nächstes Kapitel">Exkursion: Netzmaske / IPv4 und IPv6</a></ul>
      </li>
    </ul>
  </li>
</ul>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Schnellsuche</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Los" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><div id="ethical-ad-placement"></div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019 Markus Heiser.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    </div>
  <script src="../_static/version_warning_offset.js"></script>

  </body>
</html>